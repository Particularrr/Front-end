<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta name="renderer" content="webkit">
  <title></title>
  <link rel="stylesheet" href="css/pintuer.css">
  <link rel="stylesheet" href="css/admin.css">
  <script src="js/jquery.js"></script>
  <script src="js/pintuer.js"></script>
</head>

<body>
<div class="panel admin-panel">
  <div class="panel-head" id="add"><strong><span class="icon-pencil-square-o"></span>电话簿信息管理</strong></div>
  <div class="body-content">
    <form method="post" class="form-x" action="" id="telephone_form">
      <div class="form-group">
        <input type="hidden" name="id" id="id"/>
        <div class="label">
          <label>姓名：</label>
        </div>
        <div class="field">
          <input type="text" class="input w80" value="" name="name"
                 data-validate="required:请输入用户姓名"/>
          <div class="tips"></div>
        </div>
      </div>
      <div class="form-group">
        <div class="label">
          <label>地址：</label>
        </div>
        <div class="field">
          <input type="text" class="input w80" value="" name="address"/>
          <div class="tips"></div>
        </div>
      </div>
      <div class="form-group">
        <div class="label">
          <label>号码：</label>
        </div>
        <div class="field">
          <input type="text" class="input w80" value="" name="number" data-validate="required:请输入用户号码"/>
          <div class="tips"></div>
        </div>
      </div>
      <div class="form-group">
        <div class="label">
          <label>性别：</label>
        </div>
        <div class="field">
          <div class="button-group radio" id="gender">
            <label class="button">
              <span class="icon icon-check"></span>
              <input name="gender" value="男" type="radio" checked="checked">男
            </label>
            <label class="button"><span class="icon icon-times"></span>
              <input name="gender" value="女" type="radio" checked="checked">女
            </label>
          </div>
        </div>
      </div>
      <div class="clear"></div>
      <div class="form-group">
        <div class="label">
          <label></label>
        </div>
        <div class="field">
          <button id="submit_button" class="button bg-main icon-check-square-o" type="button"> 修改</button>
          <button class="button bg-main icon-check-square-o" type="button" onclick="javascript:history.back();"> 返回</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!--添加js库-->
<script src="js/form2json.js"></script>
<script>
  $(function (){
    loadtelephoneInfo();

    // 处理提交按钮点击事件
    $("#submit_button").on("click", function () {
      let data = {
        id: $("input[name='id']").val(),
        name: $("input[name='name']").val(),
        address: $("input[name='address']").val(),
        number: $("input[name='number']").val(),
        gender: $("input[name='gender']:checked").val() // 获取选中的性别
      };
      $.ajax({
        url: "../telephones/updateTelephone/",
        type: "POST",
        contentType: "application/json",
        dataType: "JSON",
        data: JSON.stringify(data),
        success: function (result) {
          console.log(result);
          if (result.data == true) {
            alert("修改成功");
            location.href = "sys_telephone.html";
          } else {
            alert("修改失败，请重试。");
          }
        },
        error: function (xhr, status, error) {
          alert("请求失败，请稍后再试。错误信息：" + error);
        }
      });
    });

  function loadtelephoneInfo(){
    let telephoneId = sessionStorage.getItem("telephoneId");
    if (telephoneId == null || telephoneId == undefined){
      location.href = "sys_telephone.html";
      return;
    }
    //alert("用户编号为：" + userId);
    $.ajax({
      url:"../telephones/findTelephoneById/"+telephoneId,
      type:"GET",
      dataType:"JSON",
      success:function (result){
        if (result.code==200){
          let telephone = result.data;
          $("input[name='id']").val(telephone.id);
          $("input[name='name']").val(telephone.name);
          $("input[name='number']").val(telephone.number);
          $("input[name='address']").val(telephone.address);
          if (telephone.gender == '男'){
            $("#state label:eq(0)").attr("class","button active");
          }
          else {
            $("#state label:eq(1)").attr("class","button active");
          }
        }
      }
    })
  }})

</script>
</body>
</html>